# soramimi-align
〇〇で歌ってみたシリーズの元歌詞と空耳歌詞をalignmentするプログラムです。
# 使い方
- 歌詞テキストを準備（directory二保存）
- アライン用の下書き作成: make_draft.py -i INPUT_FILE_OR_DIRECTORY [-o OUTPUT_FILE_OR_DIRECTORY] [-u USER_DICT] [--check_only] [--vervose]

## make_draft

`make_draft.py`は、選手一覧付きの歌詞テキストから選手の読み、歌詞の読み、文節位置をラフに推定し出力するプログラムです。以下の手順で処理が行われます。

1. **歌詞と選手一覧の抽出**:
    - 入力テキストを行ごとに分割し、空行や記号だけの行を削除します。
    - 「選手一覧」などのキーワードを含む行を探し、その行を境に歌詞パートと選手一覧パートに分割します。

2. **パロディ歌詞と元の歌詞の分割**:
    - 歌詞パートを交互にパロディ歌詞と元の歌詞に分割します。
    - パロディ歌詞と元の歌詞の行数が一致しない場合はエラーを発生させます。

3. **選手名のフォーマット**:
    - 選手一覧パートから選手名を抽出し、正規化や不要な記号の削除を行います。

4. **歌詞の解析**:
    - パロディ歌詞と元の歌詞を解析し、各単語の表層形、発音、文節の開始位置などを取得します。
    - Sudachiを用いて形態素解析を行い、ユーザー辞書を適用して発音を取得します。

5. **発音候補の取得**:
    - 選手名や歌詞の単語から発音候補を取得し、最も適切な発音を選定します。
    - 発音候補が複数ある場合や特定の条件に基づいて発音を決定します。

6. **結果の出力**:
    - 解析結果をまとめ、指定された出力ファイルに書き込みます。
    - 複数のファイルを一括で処理する場合は、各ファイルの結果を個別に出力します。

### 入力フォーマット

- 歌詞パートと選手一覧パート。境目は「選手一覧」的な文字列を含む行
- 空行は無視
- 歌詞パートは選手表層の行と歌詞の行が交互
  - 選手表層は`(pre_silent_surface)pronounced_surface(post_silent_surface)(pronunciation)`の形式を想定。
- 歌詞パートの始まりは空白で分割した要素が1つ以上歌詞パートに含まれる最初の行
- 選手一覧パートは選手のフルネームがが1行に一つずつ
- 
```
...

選手1_1 選手2_1 ...
歌詞1

...

選手n_1 選手n_2 ...
歌詞n

選手一覧
選手1_1
選手1_2
...
選手n_m
```

# 使い方

準備として、替え歌歌詞と元歌詞を以下の形式で記載したファイルを用意してください。

```input.txt
[替え歌歌詞。スペース区切り。e.g. 宇佐美 大石]
[元歌詞。分かち書き不要。e.g. うさぎ追いし]

[替え歌歌詞]
[元歌詞]
...
```

複数のファイルを一括で処理できますので、上記形式のファイルを１つのフォルダに格納してください。
今は"data"というディレクトリにあるとします。

以下のコマンドでalignを実行できます。

```sh
git clone [url]
cd soramimi-align
uv run align_files.py data [output_path; default=output.csv]
```

